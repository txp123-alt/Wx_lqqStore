<view class="mybooking-container">
  <!-- 状态筛选 -->
  <view class="filter-tabs">
    <view 
      class="filter-tab {{activeTab === item.key ? 'active' : ''}}" 
      wx:for="{{filterTabs}}" 
      wx:key="key" 
      data-key="{{item.key}}" 
      bindtap="switchFilterTab">
      {{item.name}}
    </view>
  </view>

  <!-- 预定列表 -->
  <view class="product-list">
    <view class="product-item" wx:for="{{myBookings}}" wx:key="id">
      <!-- 预定卡片 -->
      <view class="product-card" bindtap="viewDetail" data-id="{{item.id}}">
        <!-- 顶部：预订编号和时间 -->
        <view class="card-header">
          <text class="reservation-no">预订号: {{item.reservationNo}}</text>
          <text class="reserve-time">{{item.formattedCreatedTime}}</text>
        </view>

        <!-- 中部：商品信息 -->
        <view class="card-content">
          <view class="info-row">
            <image class="product-thumb" src="/images/product-placeholder.png" mode="aspectFill"></image>
          </view>
          <view class="info-row">
            <text class="row-label">数量</text>
            <text class="row-value">{{item.quantity}}</text>
          </view>
          <view class="info-row highlight">
            <text class="row-label">总价</text>
            <text class="row-value total">¥{{item.totalPrice}}</text>
          </view>
        </view>

        <!-- 底部：状态和操作 -->
        <view class="card-footer" catchtap="onFooterTap">
          <view class="status-badge {{item.statusClass}}">
            {{item.statusText}}
          </view>
          <button
            class="cancel-btn"
            bindtap="cancelBooking"
            data-id="{{item.id}}"
            disabled="{{!item.canCancel}}">
            {{item.canCancel ? '取消预定' : ''}}
          </button>
        </view>
      </view>
    </view>
    
    <!-- 空状态 -->
    <view class="empty-state" wx:if="{{myBookings.length === 0 && !loading}}">
      <view class="empty-icon"></view>
      <text class="empty-text">暂无预定记录</text>
      <text class="empty-desc">快去预定心仪的商品吧</text>
    </view>
    
    <!-- 加载状态 -->
    <view class="loading-more" wx:if="{{loading}}">
      <text class="loading-text">加载中...</text>
    </view>
    
    <!-- 没有更多 -->
    <view class="no-more" wx:if="{{!hasMore && myBookings.length > 0}}">
      <text class="no-more-text">没有更多记录了</text>
    </view>
  </view>

  <!-- 详情弹窗 -->
  <view class="detail-modal-mask" wx:if="{{showDetailModal}}" bindtap="onCloseDetailModal">
    <view class="detail-modal" catchtap="onDetailContentTap">
      <view class="detail-modal-header">
        <text class="modal-title">预订详情</text>
        <text class="modal-close" bindtap="onCloseDetailModal">×</text>
      </view>

      <view class="detail-modal-content">
        <!-- 预订编号 -->
        <view class="detail-row">
          <text class="detail-label">预订编号</text>
          <text class="detail-value">{{currentDetail.reservationNo}}</text>
        </view>

        <!-- 预订状态 -->
        <view class="detail-row">
          <text class="detail-label">预订状态</text>
          <view class="status-badge {{currentDetail.statusClass}}">
            {{currentDetail.statusText}}
          </view>
        </view>

        <!-- 商品信息 -->
        <view class="detail-section">
          <text class="section-title">商品信息</text>
          <view class="detail-row">
            <text class="detail-label">商品ID</text>
            <text class="detail-value">{{currentDetail.productId}}</text>
          </view>
          <view class="detail-row">
            <text class="detail-label">预订数量</text>
            <text class="detail-value">{{currentDetail.quantity}}</text>
          </view>
          <view class="detail-row">
            <text class="detail-label">单价</text>
            <text class="detail-value price">¥{{currentDetail.unitPrice}}</text>
          </view>
          <view class="detail-row highlight">
            <text class="detail-label">预订总价</text>
            <text class="detail-value total">¥{{currentDetail.totalPrice}}</text>
          </view>
        </view>

        <!-- 联系信息 -->
        <view class="detail-section">
          <text class="section-title">联系信息</text>
          <view class="detail-row">
            <text class="detail-label">联系人</text>
            <text class="detail-value">{{currentDetail.contactName}}</text>
          </view>
          <view class="detail-row">
            <text class="detail-label">联系电话</text>
            <text class="detail-value">{{currentDetail.contactPhone}}</text>
          </view>
          <view class="detail-row">
            <text class="detail-label">配送地址</text>
            <text class="detail-value addr">{{currentDetail.contactAddr}}</text>
          </view>
        </view>

        <!-- 时间信息 -->
        <view class="detail-section">
          <text class="section-title">时间信息</text>
          <view class="detail-row">
            <text class="detail-label">预订日期</text>
            <text class="detail-value">{{currentDetail.reservedDate}}</text>
          </view>
          <view class="detail-row">
            <text class="detail-label">到期时间</text>
            <text class="detail-value">{{currentDetail.expiryDate}}</text>
          </view>
          <view class="detail-row">
            <text class="detail-label">创建时间</text>
            <text class="detail-value">{{currentDetail.formattedCreatedTime}}</text>
          </view>
          <view class="detail-row" wx:if="{{currentDetail.confirmedAt}}">
            <text class="detail-label">确认时间</text>
            <text class="detail-value">{{currentDetail.confirmedAt}}</text>
          </view>
          <view class="detail-row" wx:if="{{currentDetail.deliveryAt}}">
            <text class="detail-label">配送时间</text>
            <text class="detail-value">{{currentDetail.deliveryAt}}</text>
          </view>
          <view class="detail-row" wx:if="{{currentDetail.completedAt}}">
            <text class="detail-label">完成时间</text>
            <text class="detail-value">{{currentDetail.completedAt}}</text>
          </view>
          <view class="detail-row" wx:if="{{currentDetail.cancelledAt}}">
            <text class="detail-label">取消时间</text>
            <text class="detail-value">{{currentDetail.cancelledAt}}</text>
          </view>
        </view>

        <!-- 备注信息 -->
        <view class="detail-section" wx:if="{{currentDetail.remark}}">
          <text class="section-title">备注信息</text>
          <text class="remark-text">{{currentDetail.remark}}</text>
        </view>
      </view>

      <view class="detail-modal-footer">
        <button class="close-btn" bindtap="onCloseDetailModal">关闭</button>
      </view>
    </view>
  </view>
</view>