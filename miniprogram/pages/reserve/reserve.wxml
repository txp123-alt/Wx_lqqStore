<view class="reserve-container">
  <!-- é¡¶éƒ¨æœç´¢åŒºåŸŸ -->
  <view class="search-section">
    <view class="search-box">
      <view class="search-input-wrapper">
        <text class="search-icon">ğŸ”</text>
        <input 
          class="search-input" 
          placeholder="æœç´¢å•†å“åç§°..." 
          value="{{searchKeyword}}"
          bindinput="onSearchInput"
          bindconfirm="onSearchConfirm"
        />
        <text class="clear-icon" wx:if="{{searchKeyword}}" bindtap="onClearSearch">âœ•</text>
      </view>
    </view>
  </view>

  <!-- åˆ†ç±»æ ‡ç­¾ -->
  <view class="category-section">
    <scroll-view class="category-scroll" scroll-x="true">
      <view class="category-list">
        <view 
          class="category-item {{currentCategory === item.id ? 'active' : ''}}"
          wx:for="{{categories}}" 
          wx:key="id"
          data-id="{{item.id}}"
          bindtap="onCategoryChange"
        >
          <text class="category-icon">{{item.icon}}</text>
          <text class="category-name">{{item.name}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-container" wx:if="{{isLoading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>

  <!-- å•†å“åˆ—è¡¨ -->
  <view class="product-list" wx:else>
    <view class="empty-state" wx:if="{{filteredList.length === 0}}">
      <text class="empty-icon">ğŸ“¦</text>
      <text class="empty-text">æš‚æ— å¯é¢„è®¢å•†å“</text>
      <text class="empty-desc">è¯·ç¨åå†è¯•æˆ–è°ƒæ•´ç­›é€‰æ¡ä»¶</text>
    </view>

    <view 
      class="product-item" 
      wx:for="{{filteredList}}" 
      wx:key="id"
      data-product="{{item}}"
      bindtap="onReserveProduct"
    >
      <view class="product-image">
        <image src="{{item.image}}" mode="aspectFill"></image>
        <view class="stock-badge">åº“å­˜{{item.stock}}{{item.unit}}</view>
      </view>
      
      <view class="product-info">
        <view class="product-name">{{item.name}}</view>
        <view class="product-category">
          <text class="category-tag">
            {{item.categoryIcon || 'ğŸ“¦'}} {{item.categoryName || item.category}}
          </text>
        </view>
        
        <view class="product-footer">
          <view class="price-section">
            <text class="price-symbol">Â¥</text>
            <text class="price-value">{{formatPrice(item.price)}}</text>
            <text class="price-unit">/{{item.unit}}</text>
          </view>
          
          <view class="reserve-btn">
            <text class="btn-text">é¢„å®š</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- é¢„å®šå¼¹çª— -->
  <view class="modal-mask" wx:if="{{showReserveModal}}" bindtap="onCloseReserveModal">
    <view class="reserve-modal" catchtap="">
      <view class="modal-header">
        <text class="modal-title">é¢„å®šå•†å“</text>
        <text class="close-btn" bindtap="onCloseReserveModal">âœ•</text>
      </view>

      <view class="modal-content">
        <!-- å•†å“ä¿¡æ¯ -->
        <view class="product-summary">
          <image class="product-thumb" src="{{selectedProduct.image}}" mode="aspectFill"></image>
          <view class="product-detail">
            <text class="product-title">{{selectedProduct.name}}</text>
            <text class="product-price">Â¥{{formatPrice(selectedProduct.price)}}/{{selectedProduct.unit}}</text>
            <text class="stock-info">åº“å­˜ï¼š{{selectedProduct.stock}}{{selectedProduct.unit}}</text>
          </view>
        </view>

        <!-- é¢„å®šè¡¨å• -->
        <view class="reserve-form">
          <!-- é¢„å®šæ•°é‡ -->
          <view class="form-item">
            <text class="form-label">é¢„å®šæ•°é‡</text>
            <view class="quantity-control">
              <button class="quantity-btn minus" bindtap="onQuantityMinus">-</button>
              <input 
                class="quantity-input" 
                type="number" 
                value="{{reserveForm.quantity}}"
                bindinput="onQuantityChange"
              />
              <button class="quantity-btn plus" bindtap="onQuantityPlus">+</button>
            </view>
          </view>

          <!-- é…é€æ—¶é—´ -->
          <view class="form-item">
            <text class="form-label">é…é€æ—¶é—´ *</text>
            <picker 
              mode="datetime" 
              value="{{reserveForm.deliveryTime}}"
              bindchange="onDeliveryTimeChange"
              start="{{getMinDateTime()}}"
            >
              <view class="picker-wrapper">
                <text class="picker-text {{reserveForm.deliveryTime ? '' : 'placeholder'}}">
                  {{reserveForm.deliveryTime || 'è¯·é€‰æ‹©é…é€æ—¶é—´'}}
                </text>
                <text class="picker-arrow">â€º</text>
              </view>
            </picker>
          </view>

          <!-- é…é€åœ°å€ -->
          <view class="form-item">
            <text class="form-label">é…é€åœ°å€ *</text>
            <textarea 
              class="form-textarea" 
              placeholder="è¯·è¾“å…¥è¯¦ç»†é…é€åœ°å€"
              value="{{reserveForm.deliveryAddress}}"
              bindinput="onDeliveryAddressInput"
              maxlength="100"
            />
          </view>

          <!-- è”ç³»ç”µè¯ -->
          <view class="form-item">
            <text class="form-label">è”ç³»ç”µè¯ *</text>
            <input 
              class="form-input" 
              type="number" 
              placeholder="è¯·è¾“å…¥è”ç³»ç”µè¯"
              value="{{reserveForm.contactPhone}}"
              bindinput="onContactPhoneInput"
              maxlength="11"
            />
          </view>

          <!-- å¤‡æ³¨ -->
          <view class="form-item">
            <text class="form-label">å¤‡æ³¨ä¿¡æ¯</text>
            <textarea 
              class="form-textarea" 
              placeholder="æœ‰ä»€ä¹ˆç‰¹æ®Šè¦æ±‚è¯·åœ¨æ­¤è¯´æ˜"
              value="{{reserveForm.remark}}"
              bindinput="onRemarkInput"
              maxlength="200"
            />
          </view>

          <!-- è´¹ç”¨æ˜ç»† -->
          <view class="cost-summary">
            <view class="cost-item">
              <text class="cost-label">å•†å“å•ä»·</text>
              <text class="cost-value">Â¥{{formatPrice(selectedProduct.price)}}/{{selectedProduct.unit}}</text>
            </view>
            <view class="cost-item">
              <text class="cost-label">é¢„å®šæ•°é‡</text>
              <text class="cost-value">{{reserveForm.quantity}}{{selectedProduct.unit}}</text>
            </view>
            <view class="cost-divider"></view>
            <view class="cost-item total">
              <text class="cost-label">æ€»è®¡</text>
              <text class="cost-value total-price">Â¥{{calculateTotalPrice()}}</text>
            </view>
          </view>
        </view>
      </view>

      <view class="modal-footer">
        <button class="cancel-btn" bindtap="onCloseReserveModal">å–æ¶ˆ</button>
        <button class="submit-btn" bindtap="onSubmitReserve">ç¡®è®¤é¢„å®š</button>
      </view>
    </view>
  </view>
</view>