<view class="container">

  
  <view class="summary-section {{summaryExpanded ? 'expanded' : 'collapsed'}}" bindtap="toggleSummary">
    <text class="summary-title">{{summaryExpanded ? '总库存统计' : '库存统计'}}</text>
    
    <!-- 简要模式 -->
    <view wx:if="{{!summaryExpanded}}" class="summary-compact">
      <view class="compact-item">
        <text class="compact-label">库存</text>
        <text class="compact-value">{{totalInventoryCount}}</text>
      </view>
      <view class="compact-divider"></view>
      <view class="compact-item">
        <text class="compact-label">出摊</text>
        <text class="compact-value">{{stallItemsCount}}</text>
      </view>
      <view class="compact-divider"></view>
      <view class="compact-item">
        <text class="compact-label">总量</text>
        <text class="compact-value">{{totalItemsCount}}</text>
      </view>
      <text class="expand-icon">▼</text>
    </view>
    
    <!-- 详细模式 - 9宫格展示 -->
    <view wx:else class="summary-grid">
      <!-- 第一行 -->
      <view class="grid-item">
        <text class="grid-icon">📦</text>
        <text class="grid-value">{{totalInventoryCount}}</text>
        <text class="grid-label">库存商品</text>
      </view>
      <view class="grid-item">
        <text class="grid-icon">🛒</text>
        <text class="grid-value">{{stallItemsCount}}</text>
        <text class="grid-label">出摊商品</text>
      </view>
      <view class="grid-item">
        <text class="grid-icon">📊</text>
        <text class="grid-value">{{totalItemsCount}}</text>
        <text class="grid-label">总数量</text>
      </view>
      <!-- 第二行 -->
      <view class="grid-item">
        <text class="grid-icon">💰</text>
        <text class="grid-value">{{totalCost}}</text>
        <text class="grid-label">总成本(元)</text>
      </view>
      <view class="grid-item">
        <text class="grid-icon">🛍️</text>
        <text class="grid-value">{{stallCost}}</text>
        <text class="grid-label">出摊成本(元)</text>
      </view>
      <view class="grid-item">
        <text class="grid-icon">📈</text>
        <text class="grid-value">{{totalProfit}}</text>
        <text class="grid-label">总利润(元)</text>
      </view>
      <!-- 第三行 -->
      <view class="grid-item highlight">
        <text class="grid-icon">🌟</text>
        <text class="grid-value">{{todayProfit}}</text>
        <text class="grid-label">今日利润(元)</text>
      </view>
      <view class="grid-item">
        <text class="grid-icon">💵</text>
        <text class="grid-value">{{totalRevenue}}</text>
        <text class="grid-label">总收入(元)</text>
      </view>
      <view class="grid-item">
        <text class="grid-icon">🏪</text>
        <text class="grid-value">{{totalInventoryValue}}</text>
        <text class="grid-label">库存价值(元)</text>
      </view>
      <text class="collapse-icon">▲</text>
    </view>
  </view>
  
  <!-- 商品按钮区域 -->
  <view class="product-actions-section">
    <button class="product-btn" bindtap="showAddModal">
      <text class="btn-icon">📦</text>
      <text class="btn-text">商品入库</text>
    </button>
  </view>

  <view class="list-section">
    <view class="section-header">
      <text class="section-title">库存商品列表</text>
      <view class="search-container">
        <input class="search-input" placeholder="搜索商品名称" value="{{searchKeyword}}" bindinput="onSearchInput" />
        <text wx:if="{{searchKeyword}}" class="clear-search" bindtap="clearSearch">✕</text>
      </view>
    </view>
    
    <view wx:if="{{filteredItems.length === 0}}" class="empty">
      <text>{{searchKeyword ? '未找到相关商品' : '暂无库存商品'}}</text>
    </view>
    
    <view wx:else class="item-list">
      <view wx:for="{{filteredItems}}" wx:key="id" class="item">
        <view class="item-image">
          <image src="{{item.image || '/images/default-goods-image.png'}}" mode="aspectFill" class="goods-thumbnail"></image>
        </view>
        <view class="item-info">
          <text class="item-name">{{item.name}}</text>
          <text class="item-count">库存数量: {{item.count}}</text>
          <text class="item-cost">成本: ¥{{item.cost}}</text>
        </view>
        <view class="item-actions">
          <button size="mini" type="primary" bindtap="showAddToStallModal" data-id="{{item.id}}">添加到出摊</button>
        </view>
      </view>
    </view>
  </view>

  <!-- 商品入库弹框 -->
  <view class="modal-overlay" wx:if="{{showAddModal}}" bindtap="hideAddModal">
    <view class="modal" catchtap="stopPropagation">
      <view class="modal-header">
        <text class="modal-title">商品入库</text>
      </view>
      <view class="modal-content">
        <view class="input-group">
          <text class="input-label">商品名称</text>
          <input type="text" placeholder="请输入商品名称" bindinput="onNameInput" value="{{newItem.name}}" />
        </view>
        
        <view class="input-group">
          <text class="input-label">初始库存</text>
          <input type="number" placeholder="请输入初始库存" bindinput="onCountInput" value="{{newItem.count}}" />
        </view>
        
        <view class="input-group">
          <text class="input-label">商品成本</text>
          <input type="digit" placeholder="请输入商品成本（元）" bindinput="onCostInput" value="{{newItem.cost}}" />
        </view>
        
        <!-- 图片上传区域 -->
        <view class="image-upload-section">
          <text class="upload-label">商品图片</text>
          <view class="image-upload-container">
            <view wx:if="{{newItem.image}}" class="image-preview">
              <image class="preview-image" src="{{newItem.image}}" mode="aspectFill"></image>
              <view class="remove-image" bindtap="removeImage">
                <text class="remove-icon">×</text>
              </view>
            </view>
            <view wx:else class="upload-placeholder" bindtap="chooseImage">
              <text class="upload-icon">📷</text>
              <text class="upload-text">点击上传图片</text>
            </view>
          </view>
        </view>
      </view>
      <view class="modal-footer">
        <button type="default" bindtap="hideAddModal">取消</button>
        <button type="primary" bindtap="addItem">确认添加</button>
      </view>
    </view>
  </view>

  <!-- 添加到出摊弹框 -->
  <view class="modal-overlay" wx:if="{{showAddToStallModal}}">
    <view class="modal">
      <view class="modal-header">
        <text class="modal-title">添加到出摊</text>
      </view>
      <view class="modal-content">
        <view class="modal-info">
          <text class="modal-label">商品名称:</text>
          <text class="modal-value">{{selectedItem.name}}</text>
        </view>
        <view class="modal-info">
          <text class="modal-label">库存数量:</text>
          <text class="modal-value">{{selectedItem.count}} 件</text>
        </view>
        <view class="input-group">
          <text class="input-label">出摊数量:</text>
          <input type="number" placeholder="请输入出摊数量" bindinput="onStallCountInput" value="{{stallCount}}" />
        </view>
      </view>
      <view class="modal-footer">
        <button type="default" bindtap="hideAddToStallModal">取消</button>
        <button type="primary" bindtap="confirmAddToStall">确认添加</button>
      </view>
    </view>
  </view>
</view>