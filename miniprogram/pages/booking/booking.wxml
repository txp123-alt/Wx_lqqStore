<view class="booking-container">
  <!-- æœç´¢æ  -->
  <view class="search-bar">
    <view class="search-box">
      <input class="search-input"
             placeholder="æœç´¢å•†å“..."
             value="{{searchKeyword}}"
             bindinput="onSearchInput"
             bindconfirm="onSearch" />
      <button class="search-btn" bindtap="onSearch">æœç´¢</button>
    </view>
  </view>

  <!-- ç­›é€‰åŒºåŸŸï¼ˆå›ºå®šï¼‰ -->
  <view class="filter-container">
    <!-- åˆ†ç±»ç­›é€‰ -->
    <scroll-view class="category-scroll" scroll-x="true">
      <view class="category-list">
        <view class="category-item {{selectedCategory === item ? 'active' : ''}}"
              wx:for="{{categories}}"
              wx:key="*this"
              data-category="{{item}}"
              bindtap="onCategorySelect">
          {{item}}
        </view>
      </view>
    </scroll-view>

    <!-- æ’åºç­›é€‰ -->
    <scroll-view class="sort-scroll" scroll-x="true">
      <view class="sort-list">
        <view class="sort-item {{selectedSort === item.key ? 'active' : ''}}"
              wx:for="{{sortOptions}}"
              wx:key="key"
              data-sort="{{item.key}}"
              data-order="{{item.order}}"
              bindtap="onSortSelect">
          <text>{{item.name}}</text>
          <text class="sort-arrow" wx:if="{{item.key === selectedSort}}">{{item.order === 'asc' ? 'â†‘' : 'â†“'}}</text>
        </view>
      </view>
    </scroll-view>
  </view>

  <!-- å•†å“åˆ—è¡¨ -->
  <view class="product-list">
    <view class="product-item" wx:for="{{products}}" wx:key="id">
      <image class="product-image"
             src="{{item.image}}"
             mode="aspectFill"
             bindtap="onProductDetail"
             data-id="{{item.id}}"></image>

      <view class="product-info">
        <view class="product-header">
          <text class="product-name">{{item.name}}</text>
        </view>

        <text class="product-description">{{item.description}}</text>

        <view class="product-meta">
          <text class="product-category">{{item.category}}</text>
          <text class="product-seller">{{item.sellerName}}</text>
        </view>

        <view class="product-footer">
          <view class="price-info">
            <text class="current-price">Â¥{{item.price}}</text>
            <text class="original-price" wx:if="{{item.originalPrice}}">Â¥{{item.originalPrice}}</text>
          </view>

          <view class="stock-info">
            <text class="stock-text">åº“å­˜: {{item.stock}}</text>
            <text class="sales-text">å·²å”®: {{item.salesCount}}</text>
          </view>
        </view>

        <button class="reserve-btn"
                bindtap="onReserve"
                data-id="{{item.id}}"
                disabled="{{item.stock <= 0}}">
          {{item.stock > 0 ? 'ç«‹å³é¢„è®¢' : 'æš‚æ—¶ç¼ºè´§'}}
        </button>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{products.length === 0 && !loading}}">
      <text class="empty-icon">ğŸ›ï¸</text>
      <text class="empty-text">æš‚æ— å•†å“</text>
      <text class="empty-desc">æ¢ä¸ªå…³é”®è¯æˆ–åˆ†ç±»è¯•è¯•</text>
    </view>

    <!-- åŠ è½½çŠ¶æ€ -->
    <view class="loading-more" wx:if="{{loading}}">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>

    <!-- æ²¡æœ‰æ›´å¤š -->
    <view class="no-more" wx:if="{{!hasMore && products.length > 0}}">
      <text class="no-more-text">æ²¡æœ‰æ›´å¤šå•†å“äº†</text>
    </view>
  </view>

  <!-- é¢„è®¢å¼¹çª— -->
  <view class="reserve-modal-mask" wx:if="{{showReserveModal}}" bindtap="onCloseReserveModal">
    <view class="reserve-modal" catchtap="onModalContentTap">
      <view class="reserve-modal-header">
        <text class="modal-title">é¢„è®¢å•†å“</text>
        <text class="modal-close" bindtap="onCloseReserveModal">Ã—</text>
      </view>

      <view class="reserve-modal-content">
        <!-- å•†å“ä¿¡æ¯ -->
        <view class="reserve-product-info">
          <image class="reserve-product-image" src="{{currentProduct.image}}" mode="aspectFill"></image>
          <view class="reserve-product-detail">
            <text class="reserve-product-name">{{currentProduct.name}}</text>
            <view class="reserve-product-meta">
              <text class="reserve-price">Â¥{{currentProduct.price}}</text>
              <text class="reserve-category">{{currentProduct.category}}</text>
            </view>
          </view>
        </view>

        <!-- é¢„è®¢æ•°é‡ -->
        <view class="reserve-form-item">
          <text class="form-label">é¢„è®¢æ•°é‡</text>
          <view class="quantity-selector">
            <text class="quantity-btn" bindtap="onDecreaseQuantity">-</text>
            <text class="quantity-value">{{reserveForm.quantity}}</text>
            <text class="quantity-btn" bindtap="onIncreaseQuantity">+</text>
          </view>
        </view>

        <!-- è”ç³»äººå§“å -->
        <view class="reserve-form-item">
          <text class="form-label">è”ç³»äººå§“å</text>
          <input class="form-input"
                 placeholder="è¯·è¾“å…¥è”ç³»äººå§“å"
                 value="{{reserveForm.contactName}}"
                 bindinput="onContactNameInput" />
        </view>

        <!-- è”ç³»ç”µè¯ -->
        <view class="reserve-form-item">
          <text class="form-label">è”ç³»ç”µè¯</text>
          <input class="form-input"
                 type="number"
                 maxlength="11"
                 placeholder="è¯·è¾“å…¥è”ç³»ç”µè¯"
                 value="{{reserveForm.contactPhone}}"
                 bindinput="onContactPhoneInput" />
        </view>

        <!-- é…é€åœ°å€ -->
        <view class="reserve-form-item">
          <text class="form-label">é…é€åœ°å€</text>
          <textarea class="form-textarea"
                    style="min-height: 60rpx; height: 60rpx;"
                    placeholder="è¯·è¾“å…¥é…é€åœ°å€"
                    value="{{reserveForm.contactAddr}}"
                    bindinput="onContactAddrInput"
                    maxlength="100"></textarea>
        </view>

        <!-- å¤‡æ³¨ -->
        <view class="reserve-form-item">
          <text class="form-label">å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰</text>
          <textarea class="form-textarea"
                    style="min-height: 72rpx; height: 72rpx;"
                    placeholder="å¦‚æœ‰ç‰¹æ®Šè¦æ±‚è¯·åœ¨æ­¤è¯´æ˜"
                    value="{{reserveForm.remark}}"
                    bindinput="onRemarkInput"
                    maxlength="100"></textarea>
        </view>

        <!-- æ€»ä»· -->
        <view class="reserve-total">
          <text class="total-label">é¢„è®¢æ€»ä»·ï¼š</text>
          <text class="total-price">Â¥{{reserveTotalPrice}}</text>
        </view>
      </view>

      <view class="reserve-modal-footer">
        <button class="cancel-btn" bindtap="onCloseReserveModal">å–æ¶ˆ</button>
        <button class="confirm-btn" bindtap="onConfirmReserve">ç¡®è®¤é¢„è®¢</button>
      </view>
    </view>
  </view>
</view>
